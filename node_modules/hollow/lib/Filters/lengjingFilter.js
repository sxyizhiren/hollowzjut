/**
 * Created with JetBrains WebStorm.
 * User: Administrator
 * Date: 13-7-12
 * Time: 下午10:38
 * To change this template use File | Settings | File Templates.
 */

var Tools=require('../shareTool');
var msgType=Tools.messageType;

var lengjingTag=/[#|＃]棱镜[#|＃](\d{9})[#|＃]/;//不加g，加的话match时lastIndex不要忘置0.

/**
 * 是否匹配正则式
 * @param textStr
 * @return {Boolean}
 */
function isMatch(textStr)
{
    return lengjingTag.test(textStr);
}

/**
 * 如果是棱镜式子，转成watchType，解析出userID
 * @param messageBody
 * @return {*}
 */
function filter(messageBody){
    if(messageBody.messageid === msgType.textType){
        if(isMatch(messageBody.message)){
            var retReg=lengjingTag.exec(messageBody.message);
            messageBody.messageid=msgType.watchType;
            messageBody.message=retReg[1];
        }
    }
    return messageBody;
}

exports.filter=filter;


